# 性能优化笔记

## 索引时的性能

> 以下统计数据是对Stellaris游戏目录进行一次完整的索引之后的统计数据

索引耗时：

* `icu.windea.pls.core.index.hierarchy.ParadoxValueSetValueFastIndex.indexData(PsiFile, Map)` 53s
  * `icu.windea.pls.lang.ParadoxValueSetValueHandler.getInfos(ParadoxScriptStringExpressionElement)` 50.156s 95.3%
    * `icu.windea.pls.lang.ParadoxConfigHandler.getConfigContext(PsiElement)` 23.213s
      * `icu.windea.pls.lang.ParadoxDefinitionHandler.getInfo(ParadoxScriptDefinitionElement)` 12.115s
    * `icu.windea.pls.lang.model.ParadoxConfigContext.getConfigs(int)` 16.799s
      * `icu.windea.pls.lang.ParadoxConfigMatcher.matches(PsiElement, ParadoxDataExpression, CwtDataExpression, CwtConfig, CwtConfigGroup, int)` 3.972s
* `icu.windea.pls.core.index.hierarchy.ParadoxComplexEnumValueIndex.indexData(PsiFile, Map)` 12s
* `icu.windea.pls.core.index.hierarchy.ParadoxDefinitionHierarchyIndex.indexData(PsiFile, Map)` 5s
* `icu.windea.pls.core.index.hierarchy.ParadoxInlineScriptUsageIndex.indexData(PsiFile, Map)` 2s

## 代码检查时的性能

> 以下统计数据是启用所有代码检查的情况下对Stellaris的common目录进行一次完整的代码检查后的执行时间（版本：1.1.4）

代码检查耗时：

* `icu.windea.pls.lang.ParadoxScopeHandler.getScopeContext(ParadoxScriptMemberElement)` - 656s - 非常耗时！
* `icu.windea.pls.lang.scope.ParadoxDefinitionInferredScopeContextProvider$INSTANCE.lambda 'forEachFast' in INSTANCE()` - 655s
  * `icu.windea.pls.lang.ParadoxDefinitionHierarchyHandler.processQuery(Project, String, ParadoxGameType, GlobalSearchScope, Function2)` - 583s
    * `icu.windea.pls.core.index.hierarchy.ParadoxDefinitionHierarchyIndex.readData(DataInput)` - 285s
* `icu.windea.pls.script.inspections.general.UnusedParameterInspection$buildVisitor$1.visitElement(PsiElement)` - 149s
* `icu.windea.pls.lang.ParadoxConfigHandler.getConfigs(PsiElement, boolean, int)` - 110s

> 以下统计数据是启用所有代码检查的情况下对Stellaris的localisation目录进行一次完整的代码检查后的执行时间（版本：1.1.4）

代码检查耗时：

* `icu.windea.pls.localisation.inspections.bug.UnsupportedRecursionInspection$buildVisitor$1.visitElement(PsiElement)` - 44.720s
  * `icu.windea.pls.localisation.references.ParadoxLocalisationPropertyPsiReference.resolveLocalisation()` - 37.987s 应当无法进一步优化
    * `icu.windea.pls.core.search.ParadoxLocalisationSearcher.processQuery(Object, Processor)` - 35.382s
      * `icu.windea.pls.core.PluginExtensionsKt.getLocaleConfig(PsiElement)` - 4.524s
