<idea-plugin>
  <extensions defaultExtensionNs="com.intellij">
    <applicationConfigurable id="settings.language.pls" groupId="language" instance="icu.windea.pls.core.settings.ParadoxSettingsConfigurable"/>
    <applicationService serviceImplementation="icu.windea.pls.core.settings.ParadoxSettings"/>

    <!--override extensions-->
    <projectService serviceInterface="com.intellij.psi.impl.ResolveScopeManager" serviceImplementation="icu.windea.override.psi.impl.file.impl.ParadoxResolveScopeManager" overrides="true"/>
    <projectService serviceInterface="com.intellij.psi.search.PsiSearchHelper" serviceImplementation="icu.windea.override.psi.search.ParadoxPsiSearchHelper" overrides="true"/>
    
    <!--suppress PluginXmlValidity -->
    <fileTypeOverrider implementation="icu.windea.pls.core.ParadoxFileTypeOverrider"/>
    <utf8BomOptionProvider implementation="icu.windea.pls.core.ParadoxUtf8BomOptionProvider"/>
    
    <registryKey key="indexing.paradox.file.path.over.vfs" defaultValue="true" restartRequired="true"
                 description="Use VFS-based implementation for ParadoxFilePathIndex"/>
    <registryKey key="run.convert.dds.to.png.under.progress" defaultValue="true" restartRequired="true"
                 description="Run convert DDS to PNG write action under progress, not to freeze the UI during long operations"/>

    <library.type implementation="icu.windea.pls.core.library.ParadoxLibraryType"/>
    
    <!--<preloadingActivity implementation="icu.windea.pls.core.ParadoxPreloadActivity"/>-->
    
    <qualifiedNameProvider implementation="icu.windea.pls.core.ParadoxQualifiedNameProvider"/>
    <vfs.asyncListener implementation="icu.windea.pls.core.DescriptorOrMarkerFileListener"/>

    <readWriteAccessDetector implementation="icu.windea.pls.core.codeInsight.highlight.ParadoxReadWriteAccessDetector"/>
    <usageTypeProvider implementation="icu.windea.pls.core.codeInsight.highlight.ParadoxUsageTypeProvider"/>
    <codeInsight.typeInfo language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.codeInsight.ParadoxTypeProvider"/>
    <codeInsight.typeInfo language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.codeInsight.ParadoxTypeProvider"/>
    <typeDeclarationProvider implementation="icu.windea.pls.core.codeInsight.ParadoxTypeDeclarationProvider"/>
    <codeInsight.template.postfixTemplateProvider language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.codeInsight.template.postfix.ParadoxPostfixTemplateProvider"/>
    
    <lang.documentationProvider language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.ParadoxDocumentationProvider"/>
    <lang.documentationProvider language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.editor.ParadoxDocumentationProvider"/>
    <applicationService serviceImplementation="icu.windea.pls.core.settings.ParadoxFoldingSettings"/>
    <codeFoldingOptionsProvider instance="icu.windea.pls.core.editor.folding.ParadoxFoldingOptionsProvider"/>
    <lang.foldingBuilder language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.folding.ParadoxVariableOperationExpressionFoldingBuilder"/>
    <lang.foldingBuilder language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.folding.ParadoxScriptedVariableReferenceFoldingBuilder"/>
    <lang.foldingBuilder language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.editor.folding.ParadoxScriptedVariableReferenceFoldingBuilder"/>
    
    <fileBasedIndex implementation="icu.windea.pls.core.index.ParadoxFilePathIndex"/>
    
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxScriptedVariableNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxDefinitionNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxDefinitionTypeIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxComplexEnumIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxComplexEnumValueIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxValueSetIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxLocalisationNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxSyncedLocalisationNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxInlineScriptIndex"/>
    
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxScriptedVariableImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxDefinitionImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxComplexEnumValueImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxLocalisationImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxFileImplementationsSearch"/>
    
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxDefinitionUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxComplexEnumValueUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxLocalisationUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.CwtConfigUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxFileUsagesSearcher"/>
    
    <notificationGroup id="pls" displayType="BALLOON" isLogByDefault="true" bundle="messages.PlsBundle" key="notificationGroup.pls"/>
    
    <iconDescriptionBundle resourceBundle="messages.PlsIconBundle"/>
    
    <vfs.asyncListener implementation="icu.windea.pls.core.ParadoxTrackFileListener"/>
  </extensions>
  
  <actions>
    <group id="ParadoxGotoPathActions">
      <action id="FileChooser.Pls.GotoSteamPath" class="icu.windea.pls.core.actions.GotoSteamPathAction"/>
      <action id="FileChooser.Pls.GotoSteamGamePath" class="icu.windea.pls.core.actions.GotoSteamGamePathAction"/>
      <action id="FileChooser.Pls.GotoSteamWorkshopPath" class="icu.windea.pls.core.actions.GotoSteamWorkshopPathAction"/>
      <action id="FileChooser.Pls.GotoGameModPath" class="icu.windea.pls.core.actions.GotoGameModPathAction"/>
    </group>

    <group id="ParadoxDiffActions">
      <separator/>
      <action id="ParadoxCompareFilesAction" class="icu.windea.pls.core.diff.actions.ParadoxCompareFilesAction"
              icon="AllIcons.Actions.Diff"/>
      <action id="ParadoxCompareLocalisationsAction" class="icu.windea.pls.core.diff.actions.ParadoxCompareLocalisationsAction"
              icon="AllIcons.Actions.Diff"/>
      <action id="ParadoxCompareDefinitionsAction" class="icu.windea.pls.core.diff.actions.ParadoxCompareDefinitionsAction"
              icon="AllIcons.Actions.Diff"/>

      <add-to-group group-id="EditorPopupMenu" relative-to-action="CompareClipboardWithSelection" anchor="after"/>
      <add-to-group group-id="CompareActions" relative-to-action="CompareClipboardWithSelection" anchor="after"/>
      <add-to-group group-id="ProjectViewPopupMenu" relative-to-action="CompareFileWithEditor" anchor="after"/>
    </group>
  </actions>
</idea-plugin>
