<idea-plugin>
  <extensionPoints>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxLocalScriptedVariableSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxGlobalScriptedVariableSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxDefinitionSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxLocalisationSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxSyncedLocalisationSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxFilePathSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>

    <extensionPoint qualifiedName="icu.windea.pls.paradoxValueSetValuesSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
    <extensionPoint qualifiedName="icu.windea.pls.paradoxComplexEnumValueSearch" interface="com.intellij.util.QueryExecutor" dynamic="true"/>
  </extensionPoints>
  
  <extensions defaultExtensionNs="com.intellij">
    <!--override extensions-->
    <projectService serviceInterface="com.intellij.psi.impl.ResolveScopeManager" serviceImplementation="icu.windea.override.psi.impl.file.impl.ParadoxResolveScopeManager" overrides="true"/>
    <projectService serviceInterface="com.intellij.psi.search.PsiSearchHelper" serviceImplementation="icu.windea.override.psi.search.ParadoxPsiSearchHelper" overrides="true"/>
  </extensions>
  
  <extensions defaultExtensionNs="com.intellij">
    <applicationConfigurable id="settings.language.pls" groupId="language" instance="icu.windea.pls.core.settings.ParadoxSettingsConfigurable"/>
    <applicationService serviceImplementation="icu.windea.pls.core.settings.ParadoxSettings"/>
    
    <!--no configurable for project mod settings, but for single mod settings-->
    <projectService serviceImplementation="icu.windea.pls.core.settings.ParadoxProjectModSettings"/>
    
    <additionalLibraryRootsProvider implementation="icu.windea.pls.core.settings.ParadoxLibraryProvider"/>
    
    <!--suppress PluginXmlValidity -->
    <fileTypeOverrider implementation="icu.windea.pls.core.ParadoxFileTypeOverrider"/>
    <utf8BomOptionProvider implementation="icu.windea.pls.core.ParadoxUtf8BomOptionProvider"/>
    
    <registryKey key="indexing.paradox.file.path.over.vfs" defaultValue="true" restartRequired="true"
                 description="Use VFS-based implementation for ParadoxFilePathIndex"/>
    <registryKey key="run.convert.dds.to.png.under.progress" defaultValue="true" restartRequired="true"
                 description="Run convert DDS to PNG write action under progress, not to freeze the UI during long operations"/>

    <library.type implementation="icu.windea.pls.core.library.ParadoxLibraryType"/>
    
    <vfs.asyncListener implementation="icu.windea.pls.core.DescriptorOrMarkerFileListener"/>

    <qualifiedNameProvider implementation="icu.windea.pls.core.ParadoxQualifiedNameProvider"/>
    <readWriteAccessDetector implementation="icu.windea.pls.core.codeInsight.highlight.ParadoxReadWriteAccessDetector"/>
    <usageTypeProvider implementation="icu.windea.pls.core.codeInsight.highlight.ParadoxUsageTypeProvider"/>
    <codeInsight.typeInfo language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.codeInsight.ParadoxTypeProvider"/>
    <codeInsight.typeInfo language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.codeInsight.ParadoxTypeProvider"/>
    <typeDeclarationProvider implementation="icu.windea.pls.core.codeInsight.ParadoxTypeDeclarationProvider"/>
    <codeInsight.template.postfixTemplateProvider language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.codeInsight.template.postfix.ParadoxPostfixTemplateProvider"/>
    
    <lang.documentationProvider language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.ParadoxDocumentationProvider"/>
    <lang.documentationProvider language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.editor.ParadoxDocumentationProvider"/>
    <applicationService serviceImplementation="icu.windea.pls.core.settings.ParadoxFoldingSettings"/>
    <codeFoldingOptionsProvider instance="icu.windea.pls.core.editor.folding.ParadoxFoldingOptionsProvider"/>
    <lang.foldingBuilder language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.folding.ParadoxVariableOperationExpressionFoldingBuilder"/>
    <lang.foldingBuilder language="PARADOX_SCRIPT" implementationClass="icu.windea.pls.core.editor.folding.ParadoxScriptedVariableReferenceFoldingBuilder"/>
    <lang.foldingBuilder language="PARADOX_LOCALISATION" implementationClass="icu.windea.pls.core.editor.folding.ParadoxScriptedVariableReferenceFoldingBuilder"/>
    
    <fileBasedIndex implementation="icu.windea.pls.core.index.ParadoxFilePathIndex"/>
    
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxScriptedVariableNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxDefinitionNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxDefinitionTypeIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxComplexEnumIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxComplexEnumValueIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxValueSetIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxLocalisationNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxSyncedLocalisationNameIndex"/>
    <stubIndex implementation="icu.windea.pls.core.index.ParadoxInlineScriptIndex"/>
    
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxScriptedVariableImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxDefinitionImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxComplexEnumValueImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxLocalisationImplementationsSearch"/>
    <definitionsScopedSearch implementation="icu.windea.pls.core.search.implementations.ParadoxFileImplementationsSearch"/>
    
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxDefinitionUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxComplexEnumValueUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxLocalisationUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.CwtConfigUsagesSearcher"/>
    <referencesSearch implementation="icu.windea.pls.core.search.usages.ParadoxFileUsagesSearcher"/>
    
    <notificationGroup id="pls" displayType="BALLOON" isLogByDefault="true" bundle="messages.PlsBundle" key="notificationGroup.pls"/>
    
    <iconDescriptionBundle resourceBundle="messages.PlsIconBundle"/>
    
    <vfs.asyncListener implementation="icu.windea.pls.core.ParadoxTrackFileListener"/>
  </extensions>

  <extensions defaultExtensionNs="icu.windea.pls">
    <paradoxLocalScriptedVariableSearch implementation="icu.windea.pls.core.search.ParadoxLocalScriptedVariableSearcher"/>
    <paradoxGlobalScriptedVariableSearch implementation="icu.windea.pls.core.search.ParadoxGlobalScriptedVariableSearcher"/>
    <paradoxDefinitionSearch implementation="icu.windea.pls.core.search.ParadoxDefinitionSearcher"/>
    <paradoxLocalisationSearch implementation="icu.windea.pls.core.search.ParadoxLocalisationSearcher"/>
    <paradoxSyncedLocalisationSearch implementation="icu.windea.pls.core.search.ParadoxSyncedLocalisationSearcher"/>
    <paradoxFilePathSearch implementation="icu.windea.pls.core.search.ParadoxFilePathSearcher"/>

    <paradoxComplexEnumValueSearch implementation="icu.windea.pls.core.search.ParadoxComplexEnumValueSearcher"/>
    <paradoxValueSetValuesSearch implementation="icu.windea.pls.core.search.ParadoxValueSetValueSearcher"/>
  </extensions>
  
  <projectListeners>
    <listener class="icu.windea.pls.core.settings.ParadoxUpdateLibraryOnModSettingsChangedListener"
              topic="icu.windea.pls.core.settings.ParadoxModSettingsChangedListener"/>
  </projectListeners>
  
  <actions>
    <group id="Pls.Tools" popup="true">
      <add-to-group group-id="ToolsMenu"/>
      <add-to-group group-id="EditorPopupMenu"/>
      <add-to-group group-id="ProjectViewPopupMenu"/>
    </group>
    
    <action id="Pls.OpenModSettings" class="icu.windea.pls.core.settings.actions.OpenModSettingsAction"
            icon="PlsIcons.Actions.ModSettings">
      <keyboard-shortcut keymap="$default" first-keystroke="control alt m"/>
      <add-to-group group-id="Pls.Tools" anchor="first"/>
      <add-to-group group-id="EditorContextBarMenu" anchor="first"/>
    </action>
    
    <group id="Pls.OpenPath" popup="true">
      <action id="Pls.OpenPath.OpenSteamPath" class="icu.windea.pls.core.tool.actions.OpenSteamPathAction"
              icon="PlsIcons.Actions.SteamDirectory"/>
      <action id="Pls.OpenPath.OpenSteamGamePath" class="icu.windea.pls.core.tool.actions.OpenSteamGamePathAction"
              icon="PlsIcons.Actions.SteamGameDirectory"/>
      <action id="Pls.OpenPath.OpenSteamWorkshopPath" class="icu.windea.pls.core.tool.actions.OpenSteamWorkshopPathAction"
              icon="PlsIcons.Actions.SteamWorkshopDirectory"/>
      <action id="Pls.OpenPath.OpenGameDataPath" class="icu.windea.pls.core.tool.actions.OpenGameDataPathAction"
              icon="PlsIcons.Actions.GameDataDirectory"/>
      <add-to-group group-id="Pls.Tools"/>
    </group>
    
    <group id="Pls.GotoPath">
      <action id="Pls.FileChooser.GotoSteamPath" class="icu.windea.pls.core.library.actions.GotoSteamPathAction"
              icon="PlsIcons.Actions.SteamDirectory"/>
      <action id="Pls.FileChooser.GotoSteamGamePath" class="icu.windea.pls.core.library.actions.GotoSteamGamePathAction"
              icon="PlsIcons.Actions.SteamGameDirectory"/>
      <action id="Pls.FileChooser.GotoSteamWorkshopPath" class="icu.windea.pls.core.library.actions.GotoSteamWorkshopPathAction"
              icon="PlsIcons.Actions.SteamWorkshopDirectory"/>
      <action id="Pls.FileChooser.GotoGameDataPath" class="icu.windea.pls.core.library.actions.GotoGameDataPathAction"
              icon="PlsIcons.Actions.GameDataDirectory"/>
    </group>
    <group id="Pls.GotoPath.WithSeparator">
      <separator/>
      <reference ref="Pls.GotoPath"/>
      <add-to-group group-id="FileChooserToolbar" anchor="last"/>
    </group>

    <group id="Pls.Diff">
      <action id="Pls.Diff.ParadoxCompareFiles" class="icu.windea.pls.core.diff.actions.ParadoxCompareFilesAction"
              icon="AllIcons.Actions.Diff">
        <keyboard-shortcut keymap="$default" first-keystroke="control alt f"/>
      </action>
      <action id="Pls.Diff.ParadoxCompareDefinitions" class="icu.windea.pls.core.diff.actions.ParadoxCompareDefinitionsAction"
              icon="AllIcons.Actions.Diff">
        <keyboard-shortcut keymap="$default" first-keystroke="control alt d"/>
      </action>
      <action id="Pls.Diff.ParadoxCompareLocalisations" class="icu.windea.pls.core.diff.actions.ParadoxCompareLocalisationsAction"
              icon="AllIcons.Actions.Diff">
        <keyboard-shortcut keymap="$default" first-keystroke="control alt l"/>
      </action>
    </group>
    <group id="Pls.Diff.WithSeparator">
      <separator/>
      <reference ref="Pls.Diff"/>
      <add-to-group group-id="CompareActions" relative-to-action="CompareClipboardWithSelection" anchor="after"/>
      <add-to-group group-id="EditorPopupMenu" relative-to-action="CompareClipboardWithSelection" anchor="after"/>
      <add-to-group group-id="ProjectViewPopupMenu" relative-to-action="CompareFileWithEditor" anchor="after"/>
      <add-to-group group-id="EditorContextBarMenu" anchor="last"/>
    </group>
  </actions>
</idea-plugin>
